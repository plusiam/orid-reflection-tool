<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORID ì„±ì°° í•™ìŠµì§€</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        /* í…œí”Œë¦¿ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .template-card {
            transition: all 0.2s ease;
            min-height: 120px;
        }
        .template-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .template-card:active {
            transform: translateY(0px);
        }
        
        /* ëª¨ë°”ì¼ í„°ì¹˜ ìµœì í™” */
        .touch-target {
            min-width: 44px;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .mobile-input {
            font-size: 16px; /* iOS í™•ëŒ€ ë°©ì§€ */
        }
        
        /* ëª¨ë°”ì¼ ë²„íŠ¼ ìµœì í™” */
        .mobile-button {
            padding: 12px 16px;
            font-size: 16px;
            min-height: 48px;
        }
        
        /* ìŠ¤ë§ˆíŠ¸í° ìµœì í™” */
        @media (max-width: 640px) {
            .template-card {
                min-height: 100px;
                padding: 16px !important;
            }
            
            .stage-section {
                padding: 16px !important;
                margin-bottom: 16px !important;
            }
            
            .input-group {
                margin-bottom: 12px !important;
            }
            
            .button-group {
                flex-direction: column !important;
                gap: 12px !important;
            }
            
            .header-text {
                font-size: 1.5rem !important;
                line-height: 1.3 !important;
            }
        }
        
        /* í”„ë¦°íŠ¸ ìŠ¤íƒ€ì¼ */
        @media print {
            .print-hidden {
                display: none !important;
            }
            .print-container {
                box-shadow: none !important;
                margin: 0 !important;
                max-width: none !important;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

    <!-- ===== ìœ í˜• ì„ íƒ í™”ë©´ (ë©”ì¸ í™”ë©´) ===== -->
    <div id="template-selection-screen" class="flex items-center justify-center min-h-screen p-4">
        <div class="max-w-4xl w-full">
            <div class="bg-white p-6 sm:p-8 lg:p-10 rounded-2xl shadow-xl">
                <!-- í—¤ë” -->
                <header class="text-center mb-6 sm:mb-8">
                    <h1 class="text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-800 mb-3">ğŸ“ ORID ì„±ì°° í•™ìŠµì§€</h1>
                    <p class="text-sm sm:text-base text-gray-600 mb-2">í•™ìŠµí•œ ë‚´ìš©ì— ë§ëŠ” ìœ í˜•ì„ ì„ íƒí•´ì£¼ì„¸ìš”</p>
                    <p class="text-xs sm:text-sm text-gray-500">ORID ë°©ë²•ë¡ ìœ¼ë¡œ ìƒê°ì„ ì²´ê³„ì ìœ¼ë¡œ ì •ë¦¬í•˜ê³  ì„±ì°°í•´ë³´ì„¸ìš”</p>
                </header>

                <!-- í…œí”Œë¦¿ ì„ íƒ -->
                <section>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6" id="template-cards">
                        <!-- í…œí”Œë¦¿ ì¹´ë“œë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                    </div>
                </section>

                <!-- ì„¤ëª… -->
                <div class="mt-6 sm:mt-8 p-4 bg-blue-50 rounded-lg">
                    <h3 class="font-semibold text-blue-800 mb-2">ğŸ’¡ ORID ë°©ë²•ë¡ ì´ë€?</h3>
                    <div class="text-sm text-blue-700 space-y-1">
                        <p><strong>O</strong>bjective: ê°ê´€ì  ì‚¬ì‹¤ ì •ë¦¬</p>
                        <p><strong>R</strong>eflective: ê°ì •ê³¼ ëŠë‚Œ í‘œí˜„</p>
                        <p><strong>I</strong>nterpretive: ì˜ë¯¸ì™€ í•´ì„ ì°¾ê¸°</p>
                        <p><strong>D</strong>ecisional: ê²°ë¡ ê³¼ ì‹¤ì²œ ê³„íš</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== í•™ìŠµì§€ ì‘ì„± í™”ë©´ ===== -->
    <div id="worksheet-screen" class="hidden p-4 sm:p-8">
        <div class="max-w-4xl mx-auto">
            <div class="bg-white p-4 sm:p-6 lg:p-10 rounded-2xl shadow-xl border-4" id="worksheet-container">
                <!-- í—¤ë” -->
                <header class="text-center mb-6 sm:mb-8">
                    <h1 class="header-text text-2xl sm:text-3xl lg:text-4xl font-bold mb-2" id="worksheet-title">ğŸ“œ ì„±ì°° í•™ìŠµì§€</h1>
                    <div class="p-3 sm:p-4 rounded-lg" id="worksheet-subtitle">
                        <p class="text-sm sm:text-base text-gray-700" id="template-description"></p>
                    </div>
                </header>

                <form id="student-form">
                    <!-- í•™ìƒ ì •ë³´ -->
                    <section class="bg-gray-50 p-3 sm:p-4 rounded-lg mb-6 sm:mb-8">
                        <h2 class="text-lg sm:text-xl font-semibold text-gray-800 mb-4">ğŸ‘¨â€ğŸ“ í•™ìƒ ì •ë³´</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="input-group">
                                <label for="student-school" class="block text-sm font-medium text-gray-700 mb-2">í•™êµëª…</label>
                                <input type="text" id="student-school" name="student-school" 
                                       class="mobile-input w-full p-3 sm:p-4 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" 
                                       placeholder="ì˜ˆ: ì„œìš¸ì´ˆë“±í•™êµ">
                            </div>
                            <div class="input-group">
                                <label for="student-class" class="block text-sm font-medium text-gray-700 mb-2">í•™ë°˜</label>
                                <input type="text" id="student-class" name="student-class" 
                                       class="mobile-input w-full p-3 sm:p-4 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" 
                                       placeholder="ì˜ˆ: 3í•™ë…„ 2ë°˜">
                            </div>
                            <div class="input-group">
                                <label for="student-name" class="block text-sm font-medium text-gray-700 mb-2">ì´ë¦„ *</label>
                                <input type="text" id="student-name" name="student-name" required
                                       class="mobile-input w-full p-3 sm:p-4 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" 
                                       placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                            </div>
                        </div>
                    </section>

                    <!-- í•™ìŠµ ì£¼ì œ -->
                    <section class="bg-blue-50 p-3 sm:p-4 rounded-lg mb-6 sm:mb-8">
                        <h2 class="text-lg sm:text-xl font-semibold text-gray-800 mb-4">ğŸ“š í•™ìŠµ ì£¼ì œ</h2>
                        <div class="input-group">
                            <label for="learning-topic" class="block text-sm font-medium text-gray-700 mb-2">ì˜¤ëŠ˜ í•™ìŠµí•œ ë‚´ìš©ì´ë‚˜ ì£¼ì œë¥¼ ì ì–´ì£¼ì„¸ìš”</label>
                            <input type="text" id="learning-topic" name="learning-topic" 
                                   class="mobile-input w-full p-3 sm:p-4 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" 
                                   placeholder="ì˜ˆ: í¥ë¶€ì™€ ë†€ë¶€, ë¬¼ì˜ ìƒíƒœë³€í™” ì‹¤í—˜, ì¡°ì„ ì‹œëŒ€ ë¬¸í™”">
                        </div>
                    </section>

                    <!-- í•™ìŠµì§€ ë‹¨ê³„ë“¤ -->
                    <div id="worksheet-stages" class="space-y-6 sm:space-y-8">
                        <!-- ë‹¨ê³„ë³„ ë‚´ìš©ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                    </div>

                    <!-- ë²„íŠ¼ -->
                    <div class="mt-8 sm:mt-10 button-group flex flex-col sm:flex-row gap-4">
                        <button type="submit" 
                                class="w-full sm:w-auto flex-1 bg-blue-500 text-white font-bold mobile-button rounded-lg hover:bg-blue-600 transition-colors">
                            ì„±ì°° ì™„ë£Œ! ğŸ‰
                        </button>
                        <button type="button" id="reset-student" 
                                class="w-full sm:w-auto bg-gray-200 text-gray-700 font-bold mobile-button rounded-lg hover:bg-gray-300 transition-colors">
                            ë‹¤ì‹œ ì‘ì„±
                        </button>
                        <button type="button" onclick="goHome()" 
                                class="w-full sm:w-auto bg-gray-100 text-gray-600 font-bold mobile-button rounded-lg hover:bg-gray-200 transition-colors">
                            ğŸ  ì²˜ìŒìœ¼ë¡œ
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ===== ê²°ê³¼ í™”ë©´ ===== -->
    <div id="results-screen" class="hidden p-4 sm:p-8">
        <div class="max-w-4xl mx-auto">
            <div id="results-container" class="bg-white p-4 sm:p-6 lg:p-8 rounded-2xl shadow-xl print-container">
                <!-- ê²°ê³¼ í—¤ë” -->
                <div class="text-center mb-6 sm:mb-8 border-b-4 pb-6" id="result-header">
                    <h1 class="text-2xl sm:text-3xl font-bold mb-2" id="result-title">ğŸ“œ ë‚˜ì˜ ì„±ì°° í•™ìŠµì§€</h1>
                    <div class="p-3 sm:p-4 rounded-lg" id="result-info-box">
                        <p class="text-base sm:text-lg font-semibold" id="result-topic-title"></p>
                        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mt-2 text-xs sm:text-sm text-gray-600 gap-1 sm:gap-0">
                            <span id="result-student-info"></span>
                            <span id="result-date-info"></span>
                        </div>
                    </div>
                </div>

                <!-- ê²°ê³¼ ë‹¨ê³„ë“¤ -->
                <div id="result-stages" class="space-y-6 sm:space-y-8">
                    <!-- ê²°ê³¼ê°€ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>

                <!-- í‘¸í„° -->
                <div class="mt-6 sm:mt-8 pt-6 border-t-2 border-gray-200 text-center text-xs sm:text-sm text-gray-500">
                    <p>ì´ í•™ìŠµì§€ëŠ” ORID ë°©ë²•ë¡ ì„ í™œìš©í•œ ì„±ì°° í•™ìŠµì˜ ê²°ê³¼ë¬¼ì…ë‹ˆë‹¤.</p>
                </div>

                <!-- ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ -->
                <div class="mt-6 sm:mt-8 button-group flex flex-col sm:flex-row gap-4 print-hidden">
                    <button onclick="downloadAsImage()" 
                            class="flex-1 bg-blue-500 text-white font-bold mobile-button rounded-lg hover:bg-blue-600 transition-colors">
                        ğŸ“· ì´ë¯¸ì§€ë¡œ ë‹¤ìš´ë¡œë“œ
                    </button>
                    <button onclick="downloadAsPDF()" 
                            class="flex-1 bg-red-500 text-white font-bold mobile-button rounded-lg hover:bg-red-600 transition-colors">
                        ğŸ“„ PDFë¡œ ë‹¤ìš´ë¡œë“œ
                    </button>
                    <button onclick="writeNew()" 
                            class="flex-1 bg-green-500 text-white font-bold mobile-button rounded-lg hover:bg-green-600 transition-colors">
                        âœï¸ ìƒˆë¡œ ì‘ì„±í•˜ê¸°
                    </button>
                    <button onclick="goHome()" 
                            class="bg-gray-300 hover:bg-gray-400 text-gray-700 font-bold mobile-button rounded-lg transition-colors">
                        ğŸ  ì²˜ìŒìœ¼ë¡œ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== ì „ì—­ ë³€ìˆ˜ ====================
        let selectedTemplate = '';
        let qaCounters = {};

        // ==================== í…œí”Œë¦¿ ì •ì˜ ====================
        const templates = {
            literature: {
                name: 'ë¬¸í•™ì‘í’ˆ',
                emoji: 'ğŸ“š',
                description: 'ì†Œì„¤, ì‹œ, ë™í™” ë“± ë¬¸í•™ ì‘í’ˆì„ ì½ê³  ì„±ì°°í•  ë•Œ ì‚¬ìš©í•˜ì„¸ìš”',
                colors: ['amber-500', 'orange-500', 'red-500', 'pink-500'],
                bgColors: ['amber-50', 'orange-50', 'red-50', 'pink-50'],
                borderColors: ['amber-300', 'orange-300', 'red-300', 'pink-300'],
                stages: {
                    1: { title: 'ì‘í’ˆ ì† í•µì‹¬ ì •ë³´', subtitle: 'ë“±ì¥ì¸ë¬¼, ë°°ê²½, ì‚¬ê±´ ë“±ì„ ê¸°ë¡í•˜ì„¸ìš”', placeholder: 'ë“±ì¥ì¸ë¬¼, ë°°ê²½, ì‚¬ê±´ ë“±ì„ ê¸°ë¡í•˜ì„¸ìš”...', icon: 'ğŸ“–' },
                    2: { title: 'ì½ìœ¼ë©° ëŠë‚€ ê°ì •', subtitle: 'ì´ ì¥ë©´ì—ì„œ ì–´ë–¤ ê¸°ë¶„ì´ ë“¤ì—ˆë‚˜ìš”?', placeholder: 'ì½ìœ¼ë©° ëŠë‚€ ê°ì •ì´ë‚˜ ìƒê°ì„ ì ì–´ë³´ì„¸ìš”...', icon: 'ğŸ’' },
                    3: { title: 'ì‘ê°€ì˜ ìˆ¨ì€ ë©”ì‹œì§€', subtitle: 'ì‘ê°€ê°€ ì „ë‹¬í•˜ë ¤ëŠ” ë©”ì‹œì§€ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?', placeholder: 'ì‘ê°€ê°€ ì „ë‹¬í•˜ë ¤ëŠ” ë©”ì‹œì§€ëŠ”?', icon: 'ğŸ­' },
                    4: { title: 'ë‚´ ì‚¶ì— ì ìš©í•  ì ', subtitle: 'ì´ ì‘í’ˆì—ì„œ ë°°ìš´ ì ì„ ì–´ë–»ê²Œ ì‹¤ì²œí• ê¹Œìš”?', placeholder: 'ì´ ì‘í’ˆì—ì„œ ë°°ìš´ ì ì„ ì–´ë–»ê²Œ ì‹¤ì²œí•  ìˆ˜ ìˆì„ê¹Œìš”?', icon: 'ğŸŒ±' }
                }
            },
            science: {
                name: 'ê³¼í•™ì‹¤í—˜',
                emoji: 'ğŸ”¬',
                description: 'ì‹¤í—˜ ê´€ì°°ì´ë‚˜ ê³¼í•™ ê°œë… í•™ìŠµ í›„ ì‚¬ìš©í•˜ì„¸ìš”',
                colors: ['blue-500', 'cyan-500', 'teal-500', 'green-500'],
                bgColors: ['blue-50', 'cyan-50', 'teal-50', 'green-50'],
                borderColors: ['blue-300', 'cyan-300', 'teal-300', 'green-300'],
                stages: {
                    1: { title: 'ì‹¤í—˜ì—ì„œ ê´€ì°°í•œ ê²ƒë“¤', subtitle: 'ì‹¤í—˜ ê²°ê³¼, ë³€í™”, ë°ì´í„° ë“±ì„ ê¸°ë¡í•˜ì„¸ìš”', placeholder: 'ì‹¤í—˜ ê²°ê³¼, ë³€í™”, ë°ì´í„° ë“±ì„ ê¸°ë¡í•˜ì„¸ìš”...', icon: 'ğŸ”' },
                    2: { title: 'ì‹¤í—˜í•˜ë©° ëŠë‚€ ì ', subtitle: 'ì‹ ê¸°í–ˆë˜ ì , ê¶ê¸ˆí–ˆë˜ ì ì„ ì ì–´ë³´ì„¸ìš”', placeholder: 'ì‹ ê¸°í–ˆë˜ ì , ê¶ê¸ˆí–ˆë˜ ì ì„ ì ì–´ë³´ì„¸ìš”...', icon: 'ğŸ¤”' },
                    3: { title: 'ê³¼í•™ ì›ë¦¬ íƒêµ¬', subtitle: 'ì™œ ì´ëŸ° ê²°ê³¼ê°€ ë‚˜ì™”ì„ê¹Œìš”?', placeholder: 'ì™œ ì´ëŸ° ê²°ê³¼ê°€ ë‚˜ì™”ì„ê¹Œìš”?', icon: 'âš—ï¸' },
                    4: { title: 'ì¼ìƒ ì† í™œìš©ë²•', subtitle: 'ì´ ì›ë¦¬ë¥¼ ì–´ë””ì— í™œìš©í•  ìˆ˜ ìˆì„ê¹Œìš”?', placeholder: 'ì´ ì›ë¦¬ë¥¼ ì–´ë””ì— í™œìš©í•  ìˆ˜ ìˆì„ê¹Œìš”?', icon: 'ğŸ’¡' }
                }
            },
            history: {
                name: 'ì—­ì‚¬í•™ìŠµ',
                emoji: 'ğŸ›ï¸',
                description: 'ì—­ì‚¬ì  ì‚¬ê±´ì´ë‚˜ ì¸ë¬¼ì— ëŒ€í•´ í•™ìŠµí•œ í›„ ì‚¬ìš©í•˜ì„¸ìš”',
                colors: ['yellow-600', 'orange-600', 'red-600', 'purple-600'],
                bgColors: ['yellow-50', 'orange-50', 'red-50', 'purple-50'],
                borderColors: ['yellow-300', 'orange-300', 'red-300', 'purple-300'],
                stages: {
                    1: { title: 'ì—­ì‚¬ì  ì‚¬ì‹¤ê³¼ ì •ë³´', subtitle: 'ì—°ë„, ì¸ë¬¼, ì‚¬ê±´, ì¥ì†Œ ë“±ì„ ê¸°ë¡í•˜ì„¸ìš”', placeholder: 'ì—°ë„, ì¸ë¬¼, ì‚¬ê±´, ì¥ì†Œ ë“±ì„ ê¸°ë¡í•˜ì„¸ìš”...', icon: 'ğŸ“œ' },
                    2: { title: 'ê·¸ ì‹œëŒ€ì— ëŒ€í•œ ëŠë‚Œ', subtitle: 'ê·¸ ì‹œëŒ€ ì‚¬ëŒë“¤ì˜ ë§ˆìŒì€ ì–´ë• ì„ê¹Œìš”?', placeholder: 'ê·¸ ì‹œëŒ€ì— ëŒ€í•´ ì–´ë–¤ ëŠë‚Œì´ ë“¤ì—ˆë‚˜ìš”?', icon: 'â°' },
                    3: { title: 'ì—­ì‚¬ì˜ ì˜ë¯¸ì™€ êµí›ˆ', subtitle: 'ì´ ì‚¬ê±´ì´ ì—­ì‚¬ì— ë¯¸ì¹œ ì˜í–¥ì€?', placeholder: 'ì´ ì‚¬ê±´ì´ ì—­ì‚¬ì— ë¯¸ì¹œ ì˜í–¥ì€?', icon: 'ğŸº' },
                    4: { title: 'í˜„ì¬ì™€ì˜ ì—°ê²°ì ', subtitle: 'ì§€ê¸ˆ ìš°ë¦¬ì—ê²Œ ì£¼ëŠ” êµí›ˆì€?', placeholder: 'ì§€ê¸ˆ ìš°ë¦¬ì—ê²Œ ì£¼ëŠ” êµí›ˆì€?', icon: 'ğŸŒ' }
                }
            },
            video: {
                name: 'ì˜ìƒí•™ìŠµ',
                emoji: 'ğŸ¬',
                description: 'ë™ì˜ìƒì´ë‚˜ ë‹¤íë©˜í„°ë¦¬ë¥¼ ì‹œì²­í•œ í›„ ì‚¬ìš©í•˜ì„¸ìš”',
                colors: ['indigo-500', 'purple-500', 'pink-500', 'rose-500'],
                bgColors: ['indigo-50', 'purple-50', 'pink-50', 'rose-50'],
                borderColors: ['indigo-300', 'purple-300', 'pink-300', 'rose-300'],
                stages: {
                    1: { title: 'ì˜ìƒ ì† í•µì‹¬ ë‚´ìš©', subtitle: 'ì¤‘ìš”í•œ ì¥ë©´, ì •ë³´, ëŒ€ì‚¬ ë“±ì„ ê¸°ë¡í•˜ì„¸ìš”', placeholder: 'ì¤‘ìš”í•œ ì¥ë©´, ì •ë³´, ëŒ€ì‚¬ ë“±ì„ ê¸°ë¡í•˜ì„¸ìš”...', icon: 'ğŸ“º' },
                    2: { title: 'ì‹œì²­í•˜ë©° ë“  ìƒê°', subtitle: 'ì¬ë¯¸ìˆì—ˆë˜ ì , ë†€ë¼ì› ë˜ ì ì„ ì ì–´ë³´ì„¸ìš”', placeholder: 'ì¬ë¯¸ìˆì—ˆë˜ ì , ë†€ë¼ì› ë˜ ì ì„ ì ì–´ë³´ì„¸ìš”...', icon: 'ğŸ’­' },
                    3: { title: 'ì˜ìƒì˜ ìˆ¨ì€ ë©”ì‹œì§€', subtitle: 'ì œì‘ìê°€ ì „ë‹¬í•˜ê³  ì‹¶ì—ˆë˜ ê²ƒì€?', placeholder: 'ì œì‘ìê°€ ì „ë‹¬í•˜ê³  ì‹¶ì—ˆë˜ ê²ƒì€?', icon: 'ğŸ¯' },
                    4: { title: 'ë‚´ê°€ ì‹¤ì²œí•  ê²ƒ', subtitle: 'ì´ ì˜ìƒì„ ë³´ê³  í•´ë³´ê³  ì‹¶ì€ ê²ƒì€?', placeholder: 'ì´ ì˜ìƒì„ ë³´ê³  í•´ë³´ê³  ì‹¶ì€ ê²ƒì€?', icon: 'ğŸš€' }
                }
            },
            activity: {
                name: 'ì²´í—˜í™œë™',
                emoji: 'ğŸª',
                description: 'ê²¬í•™, ì²´í—˜, ì‹¤ìŠµ ë“±ì˜ í™œë™ í›„ ì‚¬ìš©í•˜ì„¸ìš”',
                colors: ['emerald-500', 'teal-500', 'cyan-500', 'sky-500'],
                bgColors: ['emerald-50', 'teal-50', 'cyan-50', 'sky-50'],
                borderColors: ['emerald-300', 'teal-300', 'cyan-300', 'sky-300'],
                stages: {
                    1: { title: 'ì²´í—˜ í™œë™ ë‚´ìš©', subtitle: 'ë¬´ì—‡ì„ í–ˆëŠ”ì§€, ì–´ë–¤ ìˆœì„œë¡œ í–ˆëŠ”ì§€ ê¸°ë¡í•˜ì„¸ìš”', placeholder: 'ë¬´ì—‡ì„ í–ˆëŠ”ì§€, ì–´ë–¤ ìˆœì„œë¡œ í–ˆëŠ”ì§€ ê¸°ë¡í•˜ì„¸ìš”...', icon: 'ğŸ¯' },
                    2: { title: 'í™œë™ ì¤‘ ëŠë‚Œ', subtitle: 'ì¦ê±°ì› ë˜ ì , ì–´ë ¤ì› ë˜ ì ì„ ì ì–´ë³´ì„¸ìš”', placeholder: 'ì¦ê±°ì› ë˜ ì , ì–´ë ¤ì› ë˜ ì ì„ ì ì–´ë³´ì„¸ìš”...', icon: 'ğŸ˜Š' },
                    3: { title: 'í™œë™ì˜ ì˜ë¯¸ ì°¾ê¸°', subtitle: 'ì™œ ì´ëŸ° í™œë™ì„ í–ˆì„ê¹Œìš”?', placeholder: 'ì™œ ì´ëŸ° í™œë™ì„ í–ˆì„ê¹Œìš”?', icon: 'ğŸ”' },
                    4: { title: 'ì•ìœ¼ë¡œì˜ ê³„íš', subtitle: 'ë˜ í•´ë³´ê³  ì‹¶ì€ ê²ƒ, ê°œì„ í•˜ê³  ì‹¶ì€ ê²ƒì€?', placeholder: 'ë˜ í•´ë³´ê³  ì‹¶ì€ ê²ƒ, ê°œì„ í•˜ê³  ì‹¶ì€ ê²ƒì€?', icon: 'ğŸ“…' }
                }
            },
            general: {
                name: 'ì¼ë°˜ ì„±ì°°',
                emoji: 'ğŸ“',
                description: 'ì–´ë–¤ í•™ìŠµ í™œë™ì´ë“  ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê¸°ë³¸ í…œí”Œë¦¿ì…ë‹ˆë‹¤',
                colors: ['gray-500', 'slate-500', 'zinc-500', 'neutral-500'],
                bgColors: ['gray-50', 'slate-50', 'zinc-50', 'neutral-50'],
                borderColors: ['gray-300', 'slate-300', 'zinc-300', 'neutral-300'],
                stages: {
                    1: { title: 'í•™ìŠµ ë‚´ìš© ì •ë¦¬', subtitle: 'ì˜¤ëŠ˜ ë°°ìš´ ì¤‘ìš”í•œ ë‚´ìš©ë“¤ì„ ê¸°ë¡í•˜ì„¸ìš”', placeholder: 'ì˜¤ëŠ˜ ë°°ìš´ ì¤‘ìš”í•œ ë‚´ìš©ë“¤ì„ ê¸°ë¡í•˜ì„¸ìš”...', icon: 'ğŸ“‹' },
                    2: { title: 'í•™ìŠµí•˜ë©° ëŠë‚€ ì ', subtitle: 'ê³µë¶€í•˜ë©´ì„œ ì–´ë–¤ ìƒê°ì´ë‚˜ ëŠë‚Œì´ ë“¤ì—ˆë‚˜ìš”?', placeholder: 'ê³µë¶€í•˜ë©´ì„œ ì–´ë–¤ ìƒê°ì´ë‚˜ ëŠë‚Œì´ ë“¤ì—ˆë‚˜ìš”?', icon: 'ğŸ’­' },
                    3: { title: 'í•™ìŠµ ë‚´ìš©ì˜ ì˜ë¯¸', subtitle: 'ì™œ ì´ê²ƒì„ ë°°ìš°ëŠ” ê²ƒì¼ê¹Œìš”?', placeholder: 'ì™œ ì´ê²ƒì„ ë°°ìš°ëŠ” ê²ƒì¼ê¹Œìš”?', icon: 'ğŸ¤”' },
                    4: { title: 'ì•ìœ¼ë¡œì˜ í•™ìŠµ ê³„íš', subtitle: 'ë” ì•Œê³  ì‹¶ì€ ê²ƒ, ì‹¤ì²œí•˜ê³  ì‹¶ì€ ê²ƒì€?', placeholder: 'ë” ì•Œê³  ì‹¶ì€ ê²ƒ, ì‹¤ì²œí•˜ê³  ì‹¶ì€ ê²ƒì€?', icon: 'ğŸ¯' }
                }
            }
        };

        // ==================== ì´ˆê¸°í™” ====================
        document.addEventListener('DOMContentLoaded', function() {
            showTemplateSelection();
            renderTemplateCards();
        });

        // ==================== í™”ë©´ ì „í™˜ í•¨ìˆ˜ë“¤ ====================
        function showTemplateSelection() {
            hideAllScreens();
            document.getElementById('template-selection-screen').classList.remove('hidden');
        }

        function showWorksheet() {
            hideAllScreens();
            document.getElementById('worksheet-screen').classList.remove('hidden');
        }

        function showResults() {
            hideAllScreens();
            document.getElementById('results-screen').classList.remove('hidden');
            document.getElementById('results-screen').scrollIntoView({ behavior: 'smooth' });
        }

        function hideAllScreens() {
            const screens = ['template-selection-screen', 'worksheet-screen', 'results-screen'];
            screens.forEach(screen => {
                document.getElementById(screen).classList.add('hidden');
            });
        }

        function goHome() {
            selectedTemplate = '';
            qaCounters = {};
            showTemplateSelection();
        }

        // ==================== í…œí”Œë¦¿ ì„ íƒ ====================
        function renderTemplateCards() {
            const container = document.getElementById('template-cards');
            container.innerHTML = '';
            
            Object.entries(templates).forEach(([key, template]) => {
                const card = document.createElement('div');
                card.className = 'template-card p-4 sm:p-6 border-2 border-gray-200 rounded-lg cursor-pointer hover:shadow-md touch-target bg-white';
                card.onclick = () => selectTemplate(key);
                
                card.innerHTML = `
                    <div class="text-center">
                        <div class="text-2xl sm:text-3xl mb-3">${template.emoji}</div>
                        <h3 class="font-bold text-gray-800 text-sm sm:text-base mb-2">${template.name}</h3>
                        <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">${template.description}</p>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        function selectTemplate(templateKey) {
            selectedTemplate = templateKey;
            loadWorksheet();
        }

        // ==================== í•™ìŠµì§€ ë¡œë“œ ====================
        function loadWorksheet() {
            const template = templates[selectedTemplate];
            
            // í—¤ë” ì„¤ì •
            document.getElementById('worksheet-title').innerHTML = `${template.emoji} ${template.name} ì„±ì°°ì§€`;
            document.getElementById('template-description').textContent = template.description;
            
            // í…Œë§ˆ ìƒ‰ìƒ ì ìš©
            const container = document.getElementById('worksheet-container');
            container.className = `bg-white p-4 sm:p-6 lg:p-10 rounded-2xl shadow-xl border-4 border-${template.borderColors[0]}`;
            
            const subtitle = document.getElementById('worksheet-subtitle');
            subtitle.className = `p-3 sm:p-4 rounded-lg bg-${template.bgColors[0]}`;
            
            // ë‹¨ê³„ë³„ ì½˜í…ì¸  ìƒì„±
            renderWorksheetStages(template);
            
            // í¼ ì´ˆê¸°í™”
            initializeForm();
            
            showWorksheet();
        }

        function renderWorksheetStages(template) {
            const container = document.getElementById('worksheet-stages');
            container.innerHTML = '';
            qaCounters = {};
            
            Object.entries(template.stages).forEach(([stageNum, stage], index) => {
                const section = document.createElement('section');
                section.className = `stage-section border border-gray-200 p-4 sm:p-6 rounded-lg bg-${template.bgColors[index]}`;
                
                let stageHTML = `
                    <h3 class="text-base sm:text-lg font-bold text-${template.colors[index]} mb-2 sm:mb-3">
                        ${stage.icon} ${stageNum}ë‹¨ê³„: ${stage.title}
                    </h3>
                    <p class="text-sm text-gray-500 mb-4">${stage.subtitle}</p>
                `;
                
                if (stageNum === '3') {
                    // 3ë‹¨ê³„ëŠ” ì§ˆë¬¸-ë‹µë³€ í˜•íƒœ
                    qaCounters[`stage-${stageNum}-container`] = 0;
                    stageHTML += `
                        <div id="stage-${stageNum}-container" class="space-y-4"></div>
                        <button type="button" onclick="addQaPair('stage-${stageNum}-container')" 
                                class="mt-4 text-sm font-semibold text-${template.colors[index]} hover:text-${template.colors[index]} mobile-button bg-white border border-${template.colors[index]} rounded-md transition-colors">[+ ì§ˆë¬¸ ì¶”ê°€]</button>
                    `;
                } else {
                    // 1, 2, 4ë‹¨ê³„ëŠ” í…ìŠ¤íŠ¸ ì…ë ¥ í˜•íƒœ
                    stageHTML += `
                        <div id="stage-${stageNum}-container" class="space-y-3 sm:space-y-2"></div>
                        <button type="button" onclick="addTextInput('stage-${stageNum}-container', '${stage.placeholder}')" 
                                class="mt-4 text-sm font-semibold text-${template.colors[index]} hover:text-${template.colors[index]} mobile-button bg-white border border-${template.colors[index]} rounded-md transition-colors">[+ ë‚´ìš© ì¶”ê°€]</button>
                    `;
                }
                
                section.innerHTML = stageHTML;
                container.appendChild(section);
            });
        }

        function initializeForm() {
            // í¼ ë¦¬ì…‹
            document.getElementById('student-form').reset();
            
            // ê° ë‹¨ê³„ë³„ë¡œ ì´ˆê¸° ì…ë ¥ í•„ë“œ ì¶”ê°€
            const template = templates[selectedTemplate];
            Object.keys(template.stages).forEach(stageNum => {
                if (stageNum === '3') {
                    addQaPair(`stage-${stageNum}-container`, true);
                } else {
                    addTextInput(`stage-${stageNum}-container`, template.stages[stageNum].placeholder, true);
                }
            });
        }

        // ==================== ì…ë ¥ í•„ë“œ ì¶”ê°€ í•¨ìˆ˜ë“¤ ====================
        function addTextInput(containerId, placeholder, isInitial = false) {
            const container = document.getElementById(containerId);
            const inputEl = document.createElement('div');
            inputEl.className = 'input-group flex items-center gap-2 sm:gap-3';
            inputEl.innerHTML = `
                <input type="text" name="${containerId}-text" 
                       class="mobile-input flex-1 p-3 sm:p-4 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" 
                       placeholder="${placeholder}">
                ${!isInitial ? '<button type="button" onclick="this.parentElement.remove()" class="touch-target text-red-500 hover:text-red-700 font-bold text-xl bg-red-50 hover:bg-red-100 rounded-md border border-red-200 transition-colors">Ã—</button>' : '<div class="w-12 sm:w-8"></div>'}
            `;
            container.appendChild(inputEl);
        }

        function addQaPair(containerId, isInitial = false) {
            const container = document.getElementById(containerId);
            if (!container) return;

            const qaIndex = qaCounters[containerId]++;
            const qaPair = document.createElement('div');
            qaPair.className = 'qa-pair space-y-3 sm:space-y-2';
            qaPair.innerHTML = `
                <div class="flex items-center gap-2 sm:gap-3">
                    <input type="text" name="${containerId}-q-${qaIndex}" 
                           class="mobile-input flex-1 p-3 sm:p-4 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" 
                           placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”...">
                    ${!isInitial ? '<button type="button" onclick="this.parentElement.parentElement.remove()" class="touch-target text-red-500 hover:text-red-700 font-bold text-xl bg-red-50 hover:bg-red-100 rounded-md border border-red-200 transition-colors">&times;</button>' : '<div class="w-12 sm:w-8"></div>'}
                </div>
                <textarea name="${containerId}-a-${qaIndex}" 
                          class="mobile-input w-full p-3 sm:p-4 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" 
                          rows="3" placeholder="ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
            `;
            container.appendChild(qaPair);
        }

        // ==================== í¼ ì œì¶œ ì²˜ë¦¬ ====================
        document.getElementById('student-form').addEventListener('submit', function(e) {
            e.preventDefault();
            processSubmission(new FormData(e.target));
        });

        function processSubmission(formData) {
            const template = templates[selectedTemplate];
            
            // í•™ìƒ ì •ë³´
            const studentSchool = formData.get('student-school') || '';
            const studentClass = formData.get('student-class') || '';
            const studentName = formData.get('student-name') || 'ì´ë¦„ ì—†ìŒ';
            const learningTopic = formData.get('learning-topic') || 'ì„±ì°° í•™ìŠµ';
            
            // í•™ìƒ ì •ë³´ ì¡°í•©
            let studentInfo = studentName;
            if (studentClass) {
                studentInfo = `${studentClass} ${studentName}`;
            }
            if (studentSchool) {
                studentInfo = `${studentSchool} ${studentInfo}`;
            }
            
            // ê²°ê³¼ í—¤ë” ì„¤ì •
            document.getElementById('result-title').innerHTML = `${template.emoji} ${learningTopic}`;
            document.getElementById('result-topic-title').textContent = learningTopic;
            document.getElementById('result-student-info').textContent = studentInfo;
            document.getElementById('result-date-info').textContent = `ì‘ì„±ì¼: ${new Date().toLocaleDateString()}`;
            
            // ê²°ê³¼ ë°•ìŠ¤ ìƒ‰ìƒ ì ìš©
            const resultInfoBox = document.getElementById('result-info-box');
            resultInfoBox.className = `p-3 sm:p-4 rounded-lg bg-${template.bgColors[0]}`;
            
            const resultHeader = document.getElementById('result-header');
            resultHeader.className = `text-center mb-6 sm:mb-8 border-b-4 pb-6 border-${template.borderColors[0]}`;
            
            // ë‹¨ê³„ë³„ ê²°ê³¼ ìƒì„±
            generateResultStages(template, formData);
            
            showResults();
        }

        function generateResultStages(template, formData) {
            const resultContainer = document.getElementById('result-stages');
            resultContainer.innerHTML = '';
            
            Object.entries(template.stages).forEach(([stageNum, stage], index) => {
                const section = document.createElement('section');
                section.className = `bg-gradient-to-r from-${template.bgColors[index]} to-${template.bgColors[index]} p-4 sm:p-6 rounded-xl border-l-4 border-${template.colors[index]}`;
                
                let sectionHTML = `
                    <h2 class="text-lg sm:text-xl font-bold text-${template.colors[index]} mb-3 sm:mb-4 flex items-center">
                        <span class="mr-2">${stage.icon}</span>${stageNum}ë‹¨ê³„: ${stage.title}
                    </h2>
                `;
                
                if (stageNum === '3') {
                    // ì§ˆë¬¸-ë‹µë³€ í˜•íƒœ
                    sectionHTML += '<div class="space-y-3 sm:space-y-4">';
                    const qaCount = qaCounters[`stage-${stageNum}-container`];
                    for (let i = 0; i < qaCount; i++) {
                        const question = formData.get(`stage-${stageNum}-container-q-${i}`);
                        const answer = formData.get(`stage-${stageNum}-container-a-${i}`);
                        
                        if (question || answer) {
                            sectionHTML += `
                                <div class="bg-white p-3 sm:p-4 rounded-lg border border-gray-200">
                                    <div class="font-semibold text-gray-700 mb-2 text-sm sm:text-base">Q: ${question || 'ì§ˆë¬¸ ì—†ìŒ'}</div>
                                    <div class="text-gray-600 pl-3 sm:pl-4 border-l-2 border-gray-300 text-sm sm:text-base">A: ${answer || 'ë‹µë³€ ì—†ìŒ'}</div>
                                </div>
                            `;
                        }
                    }
                    sectionHTML += '</div>';
                } else {
                    // í…ìŠ¤íŠ¸ ëª©ë¡ í˜•íƒœ
                    const texts = formData.getAll(`stage-${stageNum}-container-text`).filter(t => t.trim() !== '');
                    sectionHTML += '<div class="space-y-2 sm:space-y-3">';
                    texts.forEach(text => {
                        sectionHTML += `
                            <div class="bg-white p-3 sm:p-4 rounded-lg border border-${template.borderColors[index]} flex items-start">
                                <span class="text-${template.colors[index]} mr-2 mt-1 flex-shrink-0">${stage.icon}</span>
                                <span class="text-sm sm:text-base">${text}</span>
                            </div>
                        `;
                    });
                    sectionHTML += '</div>';
                }
                
                section.innerHTML = sectionHTML;
                resultContainer.appendChild(section);
            });
        }

        function writeNew() {
            loadWorksheet();
        }

        // ==================== ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤ ====================
        // ì´ˆê¸°í™” ë²„íŠ¼
        document.getElementById('reset-student').addEventListener('click', function() {
            if (confirm('ì‘ì„± ì¤‘ì¸ ë‚´ìš©ì´ ëª¨ë‘ ì‚¬ë¼ì§‘ë‹ˆë‹¤. ì •ë§ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                initializeForm();
            }
        });

        // ==================== ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜ë“¤ ====================
        async function downloadAsImage() {
            const element = document.getElementById('results-container');
            const printButtons = element.querySelectorAll('.print-hidden');
            
            // ë²„íŠ¼ë“¤ ì„ì‹œ ìˆ¨ê¸°ê¸°
            printButtons.forEach(btn => btn.style.display = 'none');
            
            try {
                const canvas = await html2canvas(element, {
                    backgroundColor: '#ffffff',
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    width: element.offsetWidth,
                    height: element.offsetHeight,
                    scrollX: 0,
                    scrollY: 0
                });
                
                const link = document.createElement('a');
                const studentInfo = document.getElementById('result-student-info').textContent.replace(/[^\wê°€-í£]/g, '_');
                const topic = document.getElementById('result-topic-title').textContent.replace(/[^\wê°€-í£]/g, '_');
                link.download = `${topic}_ì„±ì°°ì§€_${studentInfo}_${new Date().getTime()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                console.log('ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ');
            } catch (error) {
                console.error('ì´ë¯¸ì§€ ìƒì„± ì˜¤ë¥˜:', error);
                alert('ì´ë¯¸ì§€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            } finally {
                // ë²„íŠ¼ë“¤ ë‹¤ì‹œ ë³´ì´ê¸°
                printButtons.forEach(btn => btn.style.display = '');
            }
        }

        async function downloadAsPDF() {
            const element = document.getElementById('results-container');
            const printButtons = element.querySelectorAll('.print-hidden');
            
            // ë²„íŠ¼ë“¤ ì„ì‹œ ìˆ¨ê¸°ê¸°
            printButtons.forEach(btn => btn.style.display = 'none');
            
            try {
                console.log('PDF ìƒì„± ì‹œì‘...');
                
                // 1ë‹¨ê³„: HTMLì„ ê³ í’ˆì§ˆ ì´ë¯¸ì§€ë¡œ ë³€í™˜
                const canvas = await html2canvas(element, {
                    backgroundColor: '#ffffff',
                    scale: 2, // ê³ í•´ìƒë„
                    useCORS: true,
                    allowTaint: true,
                    width: element.offsetWidth,
                    height: element.offsetHeight,
                    scrollX: 0,
                    scrollY: 0,
                    logging: false // ì½˜ì†” ë¡œê·¸ ë¹„í™œì„±í™”
                });
                
                console.log('ì´ë¯¸ì§€ ë³€í™˜ ì™„ë£Œ, PDF ìƒì„± ì¤‘...');
                
                // 2ë‹¨ê³„: ì´ë¯¸ì§€ë¥¼ PDFë¡œ ë³€í™˜
                const imgData = canvas.toDataURL('image/png', 1.0); // ìµœê³  í’ˆì§ˆ
                
                // jsPDF ë¼ì´ë¸ŒëŸ¬ë¦¬ í™•ì¸ ë° ì´ˆê¸°í™”
                const { jsPDF } = window.jspdf;
                if (!jsPDF) {
                    throw new Error('jsPDF ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                // A4 í¬ê¸°ë¡œ PDF ìƒì„±
                const pdf = new jsPDF('p', 'mm', 'a4');
                const pdfWidth = 210; // A4 í­ (mm)
                const pdfHeight = 297; // A4 ë†’ì´ (mm)
                
                // ì´ë¯¸ì§€ í¬ê¸° ê³„ì‚°
                const imgWidth = pdfWidth - 20; // ì¢Œìš° ì—¬ë°± 10mmì”©
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                // í˜ì´ì§€ ì—¬ë°±
                const marginTop = 10;
                const marginLeft = 10;
                
                if (imgHeight <= pdfHeight - 20) {
                    // í•œ í˜ì´ì§€ì— ë“¤ì–´ê°€ëŠ” ê²½ìš°
                    pdf.addImage(imgData, 'PNG', marginLeft, marginTop, imgWidth, imgHeight);
                } else {
                    // ì—¬ëŸ¬ í˜ì´ì§€ë¡œ ë‚˜ëˆ„ì–´ì•¼ í•˜ëŠ” ê²½ìš°
                    let yPosition = 0;
                    const pageHeight = pdfHeight - 20; // ìƒí•˜ ì—¬ë°± 10mmì”©
                    
                    while (yPosition < imgHeight) {
                        if (yPosition > 0) {
                            pdf.addPage();
                        }
                        
                        // í˜„ì¬ í˜ì´ì§€ì— ë“¤ì–´ê°ˆ ì´ë¯¸ì§€ ë†’ì´ ê³„ì‚°
                        const remainingHeight = imgHeight - yPosition;
                        const currentPageHeight = Math.min(pageHeight, remainingHeight);
                        
                        // ì´ë¯¸ì§€ì˜ ì¼ë¶€ë¶„ì„ í˜„ì¬ í˜ì´ì§€ì— ì¶”ê°€
                        const sourceY = (yPosition / imgHeight) * canvas.height;
                        const sourceHeight = (currentPageHeight / imgHeight) * canvas.height;
                        
                        // ì„ì‹œ ìº”ë²„ìŠ¤ ìƒì„±í•˜ì—¬ ì´ë¯¸ì§€ ì¼ë¶€ ì¶”ì¶œ
                        const tempCanvas = document.createElement('canvas');
                        tempCanvas.width = canvas.width;
                        tempCanvas.height = sourceHeight;
                        const tempCtx = tempCanvas.getContext('2d');
                        
                        tempCtx.drawImage(canvas, 0, sourceY, canvas.width, sourceHeight, 0, 0, canvas.width, sourceHeight);
                        const tempImgData = tempCanvas.toDataURL('image/png', 1.0);
                        
                        pdf.addImage(tempImgData, 'PNG', marginLeft, marginTop, imgWidth, currentPageHeight);
                        yPosition += pageHeight;
                    }
                }
                
                // 3ë‹¨ê³„: PDF ë‹¤ìš´ë¡œë“œ
                const studentInfo = document.getElementById('result-student-info').textContent.replace(/[^\wê°€-í£]/g, '_');
                const topic = document.getElementById('result-topic-title').textContent.replace(/[^\wê°€-í£]/g, '_');
                const fileName = `${topic}_ì„±ì°°ì§€_${studentInfo}_${new Date().getTime()}.pdf`;
                
                pdf.save(fileName);
                console.log('PDF ë‹¤ìš´ë¡œë“œ ì™„ë£Œ:', fileName);
                
            } catch (error) {
                console.error('PDF ìƒì„± ì˜¤ë¥˜:', error);
                
                // ì‚¬ìš©ìì—ê²Œ ì¹œí™”ì ì¸ ì˜¤ë¥˜ ë©”ì‹œì§€
                let errorMessage = 'PDF ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                if (error.message.includes('jsPDF')) {
                    errorMessage += ' PDF ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”©ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.';
                } else if (error.message.includes('canvas')) {
                    errorMessage += ' ì´ë¯¸ì§€ ë³€í™˜ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.';
                }
                
                alert(errorMessage + '\n\nëŒ€ì‹  ì´ë¯¸ì§€ë¡œ ë‹¤ìš´ë¡œë“œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
                
                // ì˜¤ë¥˜ ë°œìƒ ì‹œ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì œì•ˆ
                if (confirm('ì´ë¯¸ì§€ë¡œ ë‹¤ìš´ë¡œë“œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    downloadAsImage();
                }
            } finally {
                // ë²„íŠ¼ë“¤ ë‹¤ì‹œ ë³´ì´ê¸°
                printButtons.forEach(btn => btn.style.display = '');
            }
        }

        // PDF ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”© í™•ì¸ í•¨ìˆ˜
        function checkPDFLibrary() {
            if (typeof window.jspdf === 'undefined') {
                console.warn('jsPDF ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return false;
            }
            return true;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¼ì´ë¸ŒëŸ¬ë¦¬ í™•ì¸
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                if (!checkPDFLibrary()) {
                    console.warn('PDF ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                }
            }, 1000);
        });
    </script>
</body>
</html>